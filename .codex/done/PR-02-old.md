PR-02 — greentic-component: Update new scaffolding to generate clean lib.rs

Codex Prompt (paste into greentic-component repo):

PR: greentic-component — Make greentic-component new generate clean lib.rs using component_entrypoint!

Goal
Update greentic-component new so that new components’ src/lib.rs no longer contains generated export glue.
Instead, lib.rs should contain:

macro invocation greentic_interfaces_guest::component_entrypoint!(...)

describe_payload()

handle_message()

tests

Constraints

Must remain compatible with current runner and schema expectations.

Must keep the WASI marker + exports functionality via the macro (PR-01).

Must bump scaffolded dependency versions appropriately so new components compile.

Tasks

Find where the template for src/lib.rs is generated:

It may be inline string templates, handlebars, tera, include_str!, or file templates.

Replace current generated lib.rs content with minimal content:

use greentic_interfaces_guest::component_entrypoint;

component_entrypoint!({
    manifest: crate::describe_payload,
    invoke: crate::handle_message,
    invoke_stream: true,
});

pub fn describe_payload() -> String { ... }
pub fn handle_message(operation: &str, input: &str) -> String { ... }

#[cfg(test)]
mod tests { ... }


Keep current JSON manifest content and defaults, but make it easy to edit.

Ensure Cargo.toml template includes greentic-interfaces-guest with a version that contains PR-01.

Ensure world string remains correct (e.g. greentic:component/component@0.5.0) and the schemas map remains as before.

Backwards compatibility

Existing already-generated components should not be modified automatically in this PR.

Optionally add a greentic-component migrate command later; do not add now unless trivial.

Tests

Add/update integration test for the scaffolder:

Generate a component into a temp dir

cargo test it on host

If CI supports: cargo build --target wasm32-wasip2 for the generated component

Add snapshot/golden tests for generated lib.rs (string match) so it doesn’t regress.

Docs

Update README / docs showing the new minimal lib.rs.

Acceptance criteria

greentic-component new output is substantially cleaner.

Generated component builds/tests on host.

If wasm target build exists in CI, it passes.

Proceed without asking permission and keep changes tightly scoped.

PR-05 — Docs repo(s) / greentic-interfaces docs: Document the “2 functions + macro” pattern

Wherever you document component authoring, update it.

Codex Prompt (paste into the repo that owns component authoring docs; often greentic-interfaces or greentic-component):

PR: Docs — Document component_entrypoint! minimal component pattern

Goal
Update component authoring docs to show the new clean lib.rs.

Tasks

Locate docs that show component boilerplate.

Replace with the minimal macro-based approach.

Mention that the unsafe exports are generated by greentic-interfaces-guest.

Acceptance criteria

No docs encourage writing export glue by hand.

Copy/paste example works.