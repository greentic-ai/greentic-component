---
id: PR-03
title: Extend greentic-component doctor to validate component@0.6.0
date: 2026-02-05
repo: greentic-component
track: component-wizard
depends_on: [PR-01, PR-02]
---

# PR-03: Extend doctor for component@0.6.0 validation

## Goal
Extend `greentic-component doctor` to validate components targeting **component@0.6.0**.

Doctor should be able to run against:
- a local component project path
- a built wasm file (optional if already supported)

Clarification: support both. At minimum, project path must work for PR-03 tests. Implement wasm-file support if already present; otherwise allow follow-up but target both.

## Checks (component@0.6.0)
1) WIT/world/exports surface:
- Required operations exist:
  - describe
  - qa-spec
  - apply-answers
  - run
- QA modes are supported:
  - default/setup/upgrade/remove

2) CBOR decodeability:
- `describe()` returns valid CBOR bytes
- `qa-spec(mode)` returns valid CBOR bytes for each mode
- If greentic-types schemas are available, decode into typed structs; otherwise ensure CBOR is a map and canonical rules are respected for descriptors/specs.

3) i18n readiness:
- i18n keys can be enumerated (either via explicit i18n interface or by decoding QA specs and collecting I18nText keys)
- Ensure no raw user-facing strings in typed decode paths (if available)

Clarification: start with QA-spec decode approach. Call `qa-spec(mode)` for each mode, decode CBOR into greentic-types if available, collect I18nText keys. Only enforce “no raw user-facing strings” when typed structures are available.

4) Project hygiene:
- ABI version metadata present (Cargo metadata or const)
- Makefile targets exist (build/wasm/doctor)

## Output format
- Human-readable summary
- Structured diagnostics (severity, code, path, hint)
- Exit status:
  - 0 on success
  - non-zero on fatal validation failures
- Keep existing behavior for older versions; add 0.6.0 as an additional branch.

## Tests
- Run doctor against a freshly generated template and expect success.
- Add at least one negative fixture (missing qa-spec mode or missing metadata) and ensure doctor flags it.

## Acceptance criteria
- `greentic-component doctor` validates the generated template from PR-01/02.
- Clear diagnostics for missing exports, CBOR invalid, missing modes, etc.
