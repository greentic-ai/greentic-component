# PR-06 — Wizard: generate fully self-describing component@0.6.0 projects

Repo: `greentic-component`

## Goal
Upgrade `greentic-component wizard new` templates so generated components are **fully compatible 0.6.0** and **self-describing** by default.

After this PR, a freshly generated component project:
- builds a component exporting the `greentic:component@0.6.0` world
- uses **CBOR** for all I/O (input/output/state/config/answers)
- implements QA modes: default/setup/upgrade/remove
- implements i18n keys and uses `I18nText` everywhere user-facing
- returns a `describe()` payload that includes:
  - operations list (at least `run`)
  - inline SchemaIR for op input/output and component config
  - defaults/redactions/constraints (minimal but structured)
  - stable `schema_hash` per operation

No legacy surfaces.

## Scope
### In-scope
- Update wizard template tree and Rust stubs to implement all required interfaces.
- Use `greentic-types` v0.6.0 schema types (ComponentDescribe, ComponentQaSpec, SchemaIr, I18nText).
- Add helper utilities for canonical CBOR + schema hashing.
- Generate a “good by default” constrained SchemaIR (no unconstrained Any).

### Out-of-scope
- Emitting build artifacts (dist/*.describe.cbor) → PR-07.
- Pack/flow integrations.

## Template changes (generated project)
### 1) WIT + bindings
- Template includes canonical WIT package for `greentic:component@0.6.0`.
- `cargo-component` config targets `world component-v0-v6-v0`.
  - The world name must match the canonical WIT: `world component-v0-v6-v0 { ... }`
  - The fully qualified selector is `greentic:component@0.6.0` + `component-v0-v6-v0`.

### 2) Modules to generate
- `src/descriptor.rs`: implements get-component-info + describe
- `src/schema.rs`: defines SchemaIR values (input/output/config) and schema hash helpers
- `src/runtime.rs`: implements run with strict CBOR decode/encode
- `src/qa.rs`: implements qa-spec + apply-answers for all modes
- `src/i18n.rs`: defines i18n keys and returns i18n-keys list
- `src/lib.rs`: wires exports via generated bindings

### 3) Describe payload
Generated component must return `ComponentDescribe` that includes:
- `operations = [ { id: "run", input: {schema}, output: {schema}, defaults: {}, redactions: [], constraints: {}, schema_hash } ]`
- `config_schema` set to a constrained object schema
- `provided_capabilities/required_capabilities` default empty
- `metadata` default empty map

### 4) Path C1 for run schemas
- `ComponentRunInput { schema: SchemaIr }`
- `ComponentRunOutput { schema: SchemaIr }`

### 5) SchemaIR defaults (strict)
Template should generate constrained schemas out of the box. Example:
- input: object with property `"message": string(min_len=1, max_len=1024)` required
- output: object with property `"result": string(...)` required
- config: object with property `"enabled": bool` required

### 6) QA spec + apply-answers behavior
- `qa-spec(default)` returns minimal QA spec (title + optional description + questions)
- `qa-spec(setup)` includes at least one question that maps to config fields
- upgrade/remove can be empty question lists but must return a valid spec
- `apply-answers`:
  - decodes answers (CBOR) into key/value map
  - merges into current-config deterministically (BTreeMap), with mode-specific behavior:
    - default/setup: set values
    - upgrade: may add/transform fields (stub ok)
    - remove: returns empty config or sets `enabled=false` (stub ok)
  - returns canonical CBOR config map

### 7) i18n
- Every QA label/help/option/error uses `I18nText`
- Provide a minimal i18n bundle in `assets/i18n/en.json` (default) for fallback strings
- `i18n-keys()` returns all keys used by QA + describe display_name (if present)

## Wizard CLI behavior
No major CLI changes; ensure:
- `wizard new <name> --abi-version 0.6.0` generates this new template
- `--mode` controls which `examples/<mode>.answers.json` is prefilled if `--answers` is supplied
- answers JSON is converted to canonical CBOR and written as `examples/<mode>.answers.cbor`

Clarifications for `--answers`:
- If `--answers` is provided, overwrite **both** deterministically:
  - `examples/<mode>.answers.json` (human-editable source of truth)
  - `examples/<mode>.answers.cbor` (canonical CBOR)
- If `--answers` is not provided, do not create/overwrite answers files.

## Tests
Add tests in greentic-component to ensure:
- generated tree contains required modules
- generated WIT targets correct world
- `cargo component build` succeeds in a temp workspace (smoke test can be optional in CI if too heavy)
- `describe()` bytes decode as expanded `ComponentDescribe` and pass strict validation logic (reuse doctor validator if possible)

## Acceptance criteria
- Wizard-generated project builds a 0.6.0 component.
- `describe()` includes inline SchemaIR and operations list.
- QA and i18n exports are present and callable.
- No unconstrained schemas are generated by default.

## Notes
- This PR should be compatible with PR-04 doctor enforcement: after PR-06, a generated component should pass doctor strict checks.
